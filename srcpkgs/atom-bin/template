# Template file for 'atom-bin'
pkgname=atom-bin
version=1.32.2
revision=1
depends="git gtk+ GConf libnotify libXtst nss python xdg-utils
 desktop-file-utils alsa-lib libgnome-keyring libXScrnSaver"
short_desc="Hackable text editor for the 21st century"
conflicts="atom"
maintainer="shizonic <realtiaz@gmail.com>"
license="MIT"
homepage="https://atom.io/"
only_for_archs="x86_64"
nostrip=yes
nocross=yes
distfiles="https://github.com/atom/atom/releases/download/v${version}/atom-amd64.tar.gz"
checksum=f3434747eb55dbfd27b219303426eeaeddf88a1fc4ac23c599b2ee97aa518b3a
wrksrc="atom-${version}-amd64"

do_install() {
	vmkdir usr/share/atom
	vcopy ../atom-${version}-amd64/* usr/share/atom

	vmkdir usr/bin
	vbin resources/app/atom.sh ${DESTDIR}/usr/bin/atom
	ln -sf /usr/share/atom/resources/app/apm/bin/apm ${DESTDIR}/usr/bin/apm

	vmkdir usr/share/applications
	vinstall ${FILESDIR}/atom.desktop 644 usr/share/applications

	vmkdir usr/share/pixmaps
	vinstall atom.png 644 usr/share/pixmaps

	vlicense resources/LICENSE.md LICENSE
}


post_install() {
	# very hackish, git-imap-send is linked to openssl's libssl/libcrypto. Removing it allows it to package
	rm ${DESTDIR}/usr/share/atom/resources/app.asar.unpacked/node_modules/dugite/git/libexec/git-core/git-imap-send
}
